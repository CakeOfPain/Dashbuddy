<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <title>Dashbuddy</title>
        <style>
            body {
                background-image: url('{{ imageUrl }}');
            }
        </style>
    </head>
    <body>
        <div class="application">
            <div class="menu-bar">
                <button class="menu-button menu-icon" onclick="toggleWidgetMenu()">
                    <i class='bx bxs-message-square-add'></i>
                </button>
                <button class="menu-button menu-icon" onclick="toggleSettingsMenu()">
                    <i class='bx bxs-cog'></i>
                </button>
            </div>
          
            <div id="widget-container" class="widget-container-column">
            </div>

            <div class="widget-style settings-container" id="settingsMenu">
                <p>Settings</p>
                <div class="blur-slider">
                    <p id="blur"></p>
                    <input type="range" min="0" max="15" value="0" class="slider" id="background-blur">
                </div>
                <div class="accent-color">
                    <p id="accent">Accent Color:</p>
                    <div class="selection-box">
                        <input class="accent-red settings-button" type="button" onclick="setAccentColor(red)">
                        <input class="accent-green settings-button" type="button" onclick="setAccentColor(green)">
                        <input class="accent-blue settings-button" type="button" onclick="setAccentColor(blue)">
                    </div>
                </div>
            </div>

            <div class="widget-style widget-library" id="widgetLibrary">
                <p>Library</p>
            </div>
        </div>
        <script type="text/javascript" src="{{ url_for('static', filename='script.js') }}"></script>
        <script>
            const widgetContainer = document.getElementById('widget-container');
            async function loadWidgets() {
                const response = await fetch("/api/widgets");
                const responseJson =  await response.json();

                widgetContainer.innerHTML = responseJson.map(row => {
                    return '<div class="widget-container-row">' + row.map(column => {
                        if(column.plugin === "blank") {
                            return '<div class="widget"></div>';
                        }
                        const params = Object.keys(column.params).map(key => encodeURI(key) + "=" + encodeURI(column.params[key])).join("&")
                        return `<iframe class="widget" src="/plugin/${column.plugin}?${params}"></iframe>`
                    }).join("") + "</div>";
                }).join("");
            }
            loadWidgets();
        </script>
    </body>
</html>