<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <title>Dashbuddy</title>
    </head>
    <body>
        <div id="widget-container" class="widget-container-column">
        </div>

        <script>
            const widgetContainer = document.getElementById('widget-container');
            async function loadWidgets() {
                const response = await fetch("/api/widgets");
                const responseJson =  await response.json();

                widgetContainer.innerHTML = responseJson.map(row => {
                    return '<div class="widget-container-row">' + row.map(column => {
                        if(column.plugin === "blank") {
                            return '<div class="widget"></div>';
                        }
                        const params = Object.keys(column.params).map(key => encodeURI(key) + "=" + encodeURI(column.params[key])).join("&")
                        return `<iframe class="widget" src="/plugin/${column.plugin}?${params}"></iframe>`
                    }).join("") + "</div>";
                }).join("");
            }
            loadWidgets();
        </script>
    </body>
</html>